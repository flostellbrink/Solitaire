FROM ghcr.io/flostellbrink/solitaire-base:latest AS build
WORKDIR /src

COPY ["Solitaire.sln", "./"]
COPY ["Core/Core.csproj", "Core/"]
COPY ["Server/Server.csproj", "Server/"]
RUN dotnet restore "Server/Server.csproj"

COPY . .
RUN dotnet publish "Server/Server.csproj" -c Release -o /app/publish --no-restore

FROM ghcr.io/flostellbrink/solitaire-base:latest AS final
WORKDIR /app

ENV ASPNETCORE_URLS=http://+:8080
EXPOSE 8080

COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "Server.dll"]
